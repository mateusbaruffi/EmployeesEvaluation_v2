<link rel="import" href="/lib/polymer/polymer.html" />
<link rel="import" href="/lib/paper-dropdown-menu/paper-dropdown-menu.html" />
<link rel="import" href="/lib/paper-item/paper-item.html" />
<link rel="import" href="/lib/paper-listbox/paper-listbox.html" />
<link rel="import" href="/lib/paper-input/paper-input.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/iron-ajax/iron-ajax.html" />
<link rel="import" href="/lib/iron-input/iron-input.html" />



<dom-module id="question-form">
    <template>
        

        <iron-ajax 
            id="getQuestionTypesAjax"
            auto
            method="get" 
            url="http://localhost:63585/Api/Questions/GetQuestionTypes"
            handle-as="json"
            last-response="{{questionTypes}}"></iron-ajax>

        <iron-ajax id="getOwnershipsAjax"
                   auto
                   method="get"
                   url="http://localhost:63585/Api/Users/GetHrDmManagers"
                   handle-as="json"
                   last-response="{{ownerships}}"></iron-ajax>

        <iron-ajax id="saveQuestion"
                   method="post"
                   content-type="application/json"
                   handle-as="text"
                   on-response="handleQuestionResponse"
                   on-error="handleQuestionError"></iron-ajax>
        
        <div id="form-container">

            <paper-dropdown-menu label="Select Question Type">
                <paper-listbox class="dropdown-content" selected="{{selectedQuestionType}}" attr-for-selected="value">
                    <template is="dom-repeat" items="[[questionTypes]]" as="questionType">
                        <paper-item value="[[questionType.Id]]">[[questionType.Name]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-dropdown-menu>

            <paper-dropdown-menu label="Select Ownership">
                <paper-listbox class="dropdown-content" selected="{{formData.OwnershipId}}" attr-for-selected="value">
                    <template is="dom-repeat" items="[[ownerships]]" as="ownership">
                        <paper-item value="[[ownership.Id]]">[[ownership.Email]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-dropdown-menu>

            <paper-input-container>
                <label>Description</label>
                <input is="iron-input" id="QuestionDescription" type="text" bind-value="{{formData.Description}}" />
            </paper-input-container>

            <div id="answers_container">

                
                <template is="dom-repeat" items="[[likertAnswers]]" as="likertAnswer">
                    <div class="form-group">
                        <label class="col-md-2 control-label">Answer  {{displayIndex(index)}}</label>
                        <div class="col-md-10">
                            <input is="iron-input" bind-value="{{likertAnswer.Description}}" class="form-control" />
                        </div>
                    </div>
                </template>
            </div>

            <paper-button on-tap="addAnswer">Add Answer</paper-button>
            <paper-button on-tap="removeAnswer">Remove Answer</paper-button>
            <paper-button on-tap="submitForm">Save</paper-button>

        </div>
        
        
        
        
        
    </template>
</dom-module>
<script>

    var likertType = 1;
    var openEndedType = 2;

    

    Polymer({
        is: 'question-form',
        properties: {
            formData: {
                type: Object,
                value: {}
            },
            likertAnswers: {
                type: Array,
                value: function () { return [ {  }] },
                notify: true
            },
            selectedQuestionType: {
                type: String,
                observer: "_selected",
                notify: true
            },
            showHideLikertBox: {
                type: Boolean,
                value: false
            },
            showHideLimitBox: {
                type: Boolean,
                value: false
            }
         
           
        },
        ready: function () {
            console.log("I'm ready");
           
        },
        _selected: function (selected, previous) {
            console.log("------- selectedQuestionType: " + selected);

            // set the formData.QuestionTypeId value
            this.formData.QuestionTypeId = selected;
            // show/hide likertAnswers
            this.showHideLikertBox = (selected == likertType) ? true : false;
            // show/hide limitField
            this.showHideLimitBox = (selected == openEndedType) ? true : false;
        },
        submitForm: function () {
            this.$.saveQuestion.url = "http://localhost:63585/Api/Questions/Save";

            this.formData.LikertAnswers = this.likertAnswers;

            console.log(this.formData);
            console.log(this.likertAnswers);
            //this.$.saveQuestion.generateRequest();
        },
        addAnswer: function () {
            this.push('likertAnswers', {Description: '' });
        },
        removeAnswer: function (likert) {
           
            var index = this.likertAnswers.indexOf(likert);
            this.splice('likertAnswers', index, 1);
          
        },
        displayIndex: function (index) {
            return index + 1;
        }
        
    });
</script>