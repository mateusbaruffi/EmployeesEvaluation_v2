<link rel="import" href="/lib/polymer/polymer.html" />
<link rel="import" href="/lib/paper-dropdown-menu/paper-dropdown-menu.html" />
<link rel="import" href="/lib/paper-item/paper-item.html" />
<link rel="import" href="/lib/paper-listbox/paper-listbox.html" />
<link rel="import" href="/lib/paper-input/paper-input.html" />
<link rel="import" href="/lib/paper-button/paper-button.html" />
<link rel="import" href="/lib/iron-ajax/iron-ajax.html" />
<link rel="import" href="/lib/iron-input/iron-input.html" />
<link rel="import" href="/lib/iron-form/iron-form.html" />


<dom-module id="question-form">
    <template>

        <iron-ajax id="getQuestionTypesAjax"
                   auto
                   method="get"
                   url="http://localhost:63585/Api/Questions/GetQuestionTypes"
                   handle-as="json"
                   last-response="{{questionTypes}}"></iron-ajax>

        <iron-ajax id="getOwnershipsAjax"
                   auto
                   method="get"
                   url="http://localhost:63585/Api/Users/GetHrDmManagers"
                   handle-as="json"
                   last-response="{{ownerships}}"></iron-ajax>
        
        <form is="iron-form" method="post" action="/Api/Questions/Save" id="questionForm">

            <paper-dropdown-menu label="Select Question Type" required>
                <paper-listbox class="dropdown-content" selected="{{selectedQuestionType}}" attr-for-selected="value">
                    <template is="dom-repeat" items="[[questionTypes]]" as="questionType">
                        <paper-item value="[[questionType.Id]]">[[questionType.Name]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-dropdown-menu>
            <br />
            <paper-dropdown-menu label="Select Ownership" required>
                <paper-listbox class="dropdown-content" selected="{{formData.OwnershipId}}" attr-for-selected="value">
                    <template is="dom-repeat" items="[[ownerships]]" as="ownership">
                        <paper-item value="[[ownership.Id]]">[[ownership.Email]]</paper-item>
                    </template>
                </paper-listbox>
            </paper-dropdown-menu>
            <br />
            <paper-input name="Description" label="Description" bind-value="{{formData.Description}}" required></paper-input>

            <br />
            <div id="answers_container">

                <template is="dom-repeat" items="[[likertAnswers]]" as="likertAnswer">
             
                    <paper-input name="Description" label="Option {{displayIndex(index)}}" bind-value="{{likertAnswer.Description}}" required></paper-input>
            
                </template>
                <br />
                <paper-button raised on-tap="addAnswer">Add Answer</paper-button>
            </div>


            <br /><br /><br />
            <paper-button raised on-tap="_submit">Submit</paper-button>
            <paper-button raised on-tap="_reset(event)">Reset</paper-button>
            <div class="output"></div>
        </form>


</template>
</dom-module>
<script>

    var likertType = 1;
    var openEndedType = 2;

    tmpArr = [{ Description: 'hey1' }, { Description: 'hey2' }, { Description: 'hey3' }, { Description: 'hey4' }];

    Polymer({
        is: 'question-form',
        properties: {
            formData: {
                type: Object,
                value: {}
            },
            likertAnswers: {
                type: Array,
                value: function () { return [{}] },
                notify: true
            },
            selectedQuestionType: {
                type: String,
                observer: "_selected",
                notify: true
            },
            showHideLikertBox: {
                type: Boolean,
                value: false
            },
            showHideLimitBox: {
                type: Boolean,
                value: false
            }
        },
        ready: function () {
            console.log("I'm ready");
            //this.likertAnswers = tmpArr;
        },
        addAnswer: function () {
            this.push('likertAnswers', { Description: '' });
        },
        removeAnswer: function (likert) {

            var index = this.likertAnswers.indexOf(likert);
            this.splice('likertAnswers', index, 1);

        },
        displayIndex: function (index) {
            return index + 1;
        },
        _selected: function (selected, previous) {
            console.log("------- selectedQuestionType: " + selected);

            // set the formData.QuestionTypeId value
            this.formData.QuestionTypeId = selected;
            // show/hide likertAnswers
            this.showHideLikertBox = (selected == likertType) ? true : false;
            // show/hide limitField
            this.showHideLimitBox = (selected == openEndedType) ? true : false;
        },
        _submit: function (event) {

            //console.log('submit form');

            console.log(this.likertAnswers);

            this.$.questionForm.submit();
            //Polymer.dom(event).localTarget.parentElement.submit();
        }
    });







</script>